---
title: 1. About MSSQL
description: MSSQL server enumeration and exploitation series 
date: 2025-04-12 02:47:35 +/-0005
categories: [Active Directory, MSSQL]
tags: [Active Directory, MSSQL, About, HTB Academy]
---
<style>
  details {
    margin: 20px 0;
  }

  summary {
    font-weight: bold;
    cursor: pointer;
  }

  summary:hover {
    color: #007BFF;
  }

  ul {
    margin-left: 20px;
  }
</style>
---
* TOC
{:toc}

---

## ‚ùì What is MSSQL 

Microsoft SQL Server (MSSQL) is a relational database management system developed by Microsoft. It is widely used in enterprise environments, particularly within Active Directory (AD) ecosystems, where it manages and stores data critical to business operations. MSSQL is often used to handle everything from user data and application-specific records to logs and configuration settings.

In Active Directory environments, MSSQL typically serves as the backend database for various services, including Microsoft Exchange, SharePoint, and custom applications that integrate with AD. Due to its central role in storing sensitive data, MSSQL servers are prime targets for both administrative oversight and exploitation. Understanding how MSSQL operates within AD can provide security professionals with insight into potential attack vectors and enumeration methods.

## üîë MSSQL Security Principals: Logins vs. Users


In Microsoft SQL Server, **logins** and **users** are both types of security principals, but they operate at different levels:

- **Logins** exist at the **server level** and are used to authenticate users who want to connect to the SQL Server instance.
- **Users** exist at the **database level** and are used to control access within a specific database.

A single **login** can be associated with multiple **users** across different databases, but within each database, it can only be mapped to **one user**. This means that a login can have access to multiple databases but must have a corresponding user entry in each database to interact with it.

## üì° Accessing MSSQL Server
Here are some of the common tools used to access and interact with an MSSQL server for enumeration or exploitation:


1. Using [Impacket MSSQLClient](https://github.com/fortra/impacket/blob/master/examples/mssqlclient.py)
2. [Microsoft SQL Server Management Studio (SSMS)](https://learn.microsoft.com/en-us/ssms/download-sql-server-management-studio-ssms?view=sql-server-ver16)
3. [sqlcmd](https://learn.microsoft.com/en-us/sql/tools/sqlcmd/sqlcmd-utility?view=sql-server-ver16&tabs=go%2Clinux&pivots=cs1-bash)
4. [dbeaver](https://dbeaver.io/); Supports multiple databases, including MSSQL.
5. [sqsh](https://github.com/vonloxley/sqsh)

## üîê MSSQL Authentication Mechanisms

MSSQL supports two authentication modes, which means that users can be created in Windows or the SQL Server:

| **Authentication Type** | **Description** |
| --- | --- |
| **Windows authentication mode** | This is the default, often referred to as integrated security, because the SQL Server security model is tightly integrated with Windows/Active Directory. Specific Windows user and group accounts are trusted to log in to SQL Server. Windows users who have already been authenticated do not have to present additional credentials. |
| **Mixed mode** | Mixed mode supports authentication by Windows/Active Directory accounts and SQL Server. Username and password pairs are maintained within SQL Server. |

**This means that we can have three types of users to authenticate to MSSQL :**
1. Active Directory Account - Authenticated through Windows AD.
2. Local Windows Account ‚Äì User account local to the machine.
3. SQL Account ‚Äì A user account stored in the SQL Server database.

**When working with databases, we will typically perform two operations:**

- Execute SQL Queries
- Execute Windows Commands

## üßæ Basic Enumeration Queries

1. Enumerate logins as well as their server-level roles

    ```sql
    SELECT r.name, r.type_desc, r.is_disabled, sl.sysadmin, sl.securityadmin, sl.serveradmin, sl.setupadmin, sl.processadmin, sl.diskadmin, sl.dbcreator, sl.bulkadmin 
    FROM master.sys.server_principals r 
    LEFT JOIN master.sys.syslogins sl ON sl.sid = r.sid
    WHERE r.type IN ('S','E','X','U','G');
    ```
    
    ![image.png](https://file.notion.so/f/f/2ab6ea37-5cd9-465e-a988-79fae76207cd/c2b2ba14-ca3f-4b0a-8705-b1e23c0876aa/image.png?table=block&id=1c385370-06ca-807f-9087-dea9ef7d72f0&spaceId=2ab6ea37-5cd9-465e-a988-79fae76207cd&expirationTimestamp=1744516800000&signature=x7eHq7hgV_D1d-_68COAPZ7UPFJH_WmOvhwr-_ct6sk&downloadName=image.png)
    
2. Enumerating Databases
    
    
    ```sql
    SELECT a.name AS 'database', b.name AS 'owner', is_trustworthy_on
    FROM sys.databases a
    JOIN sys.server_principals b ON a.owner_sid = b.sid;
    ```
    
    ![image.png](https://file.notion.so/f/f/2ab6ea37-5cd9-465e-a988-79fae76207cd/f1b7f294-5661-4765-ad98-5e9ba5a4e5ae/image.png?table=block&id=1c385370-06ca-80c4-ac21-d30a814a877f&spaceId=2ab6ea37-5cd9-465e-a988-79fae76207cd&expirationTimestamp=1744516800000&signature=z2A1wkdRQq7l94o6Cvm8U99uDB_dcG4qkV-wUASt7tY&downloadName=image.png)
    
3. Enumerating (Database) Users
    
    
    ```sql
    USE webshop;
    EXECUTE sp_helpuser;
    ```
    
    ![image.png](https://file.notion.so/f/f/2ab6ea37-5cd9-465e-a988-79fae76207cd/d9f843a5-3b0e-44e5-b935-b0a93d2b7b04/image.png?table=block&id=1c385370-06ca-8008-b9a4-dd025d8fd909&spaceId=2ab6ea37-5cd9-465e-a988-79fae76207cd&expirationTimestamp=1744516800000&signature=kfHdWLJ2vOewAcU3O2lbWa_pD86qbNFB681lI4cAbZI&downloadName=image.png)
    
    This stored procedure helps list the users in a particular database along with their roles and permissions [sp-helpuser](ttps://learn.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-helpuser-transact-sql?view=sql-server-ver16).


